<%- include("include/_adminHeader") %>


<!-- Modals --->
<div id="addModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeAddModal">&times;</span>
    <h2>Add New Member</h2>
    <form id="addMemberForm">
      <div>
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required />
      </div>
      <div>
        <label for="position">Position:</label><br>
        <input type="text" id="position" name="position" required />
      </div>
      <div>
        <label for="school">School:</label><br>
        <input type="text" id="school" name="school" required />
      </div>
      <div>
        <label for="graduationYear">Graduation Year:</label><br>
        <input type="number" id="graduationYear" name="graduationYear" required />
      </div>
      <div>
        <label for="advisoryBoard">Advisory Board:</label><br>
        <input type="checkbox" id="advisoryBoard" name="advisoryBoard" />
      </div>
      <div id="rankDiv" style="display: none;"> 
        <label for="rank">Rank:</label><br>
        <input type="number" id="rank" name="rank" />
      </div>
      <div>
        <label for="memberImageFile">Image File:</label><br>
        <input type="file" id="memberImageFile" accept="image/*" required />
        <input type="hidden" id="memberImageData" name="imageData" />
      </div>
      <button id="addMemberButton" type="submit">Add Member</button>
    </form>
  </div>
</div>

<div class="modal" id="editModal">
  <div class="modal-content">
    <span class="close" id="closeEditModal">&times;</span>
    <h2>Edit Member</h2>
    <form id="editMemberForm">
      <input type="hidden" id="editMemberId" name="memberId" />
      <div>
        <label for="editName">Name:</label><br>
        <input type="text" id="editName" name="name" required />
      </div>
      <div>
        <label for="editPosition">Position:</label><br>
        <input type="text" id="editPosition" name="position" required />
      </div>
      <div>
        <label for="editSchool">School:</label><br>
        <input type="text" id="editSchool" name="school" required />
      </div>
      <div>
        <label for="editGraduationYear">Graduation Year:</label><br>
        <input type="number" id="editGraduationYear" name="graduationYear" required />
      </div>
      <div>
        <label for="editAdvisoryBoard">Advisory Board:</label><br>
        <input type="checkbox" id="editAdvisoryBoard" name="advisoryBoard" />
      </div>
      <div id="editRankDiv" style="display: none;"> 
        <label for="editRank">Rank:</label><br>
        <input type="number" id="editRank" name="rank" />
      </div>
      <div>
        <label for="editMemberImageFile">Image File:</label><br>
        <input type="file" id="editMemberImageFile" accept="image/*" />
        <input type="hidden" id="editMemberImageData" name="imageData" />
      </div>
      <button id="editMemberButton" type="submit">Save Changes</button>
    </form>
  </div>
</div>

<div id="deleteModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeDeleteModal">&times;</span>
    <h2>Confirm Deletion</h2>
    <p>Are you sure you want to delete this member?</p>
    <input type="hidden" id="deleteMemberId" />
    <button id="confirmDeleteButton">Yes, Delete</button>
    <button id="cancelDeleteButton">Cancel</button>
  </div>
</div>
<div class="container mt-4 text-center">
  <h1>Admin - Members</h1>
  <button class="btn btn-success mb-3" id="openAddModal">Add New Member</button>
  <table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Position</th>
      <th>Group</th>
      <th>School</th>
      <th>Graduation Year</th>
      <th>Rank</th> 
      <th>Image</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% members.forEach(member => { %>
      <tr data-id="<%= member._id %>" data-name="<%= member.name %>" data-position="<%= member.position %>" data-school="<%= member.school %>" data-graduation-year="<%= member.graduationYear %>" data-advisory-board="<%= member.advisoryBoard %>" data-rank="<%= member.rank %>">
        <td><%= member.name %></td>
        <td><%= member.position %></td>
        <td><%= member.advisoryBoard ? "Advisory Board" : "Executive Staff" %></td>
        <td><%= member.school %></td>
        <td><%= member.graduationYear %></td>
        <td><%= member.rank || '-' %></td>
        <td><img src="data:image/jpeg;base64,<%= member.imageData.toString('base64') %>" alt="<%= member.name %>" class="img-thumbnail" width="100"></td>
        <td>
          <button class="btn btn-primary" onclick="editMember('<%= member._id %>')">Edit</button>
          <button class="btn btn-danger" onclick="deleteMember('<%= member._id %>')">Delete</button>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
</div>

<script src="/js/members.js"></script>